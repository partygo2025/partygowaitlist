<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>PartyGo - Join the Waitlist</title>

  <!-- Styles mobile-first optimisÃ©s -->
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #ff6b9d 0%, #ffa726 100%);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container { 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      position: relative;
    }

    .background-pattern { 
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(255,255,255,0.05) 0%, transparent 40%),
        radial-gradient(circle at 40% 60%, rgba(255,255,255,0.08) 0%, transparent 30%),
        radial-gradient(circle at 70% 30%, rgba(255,255,255,0.06) 0%, transparent 35%);
      animation: float 25s ease-in-out infinite;
      pointer-events: none;
    }
    
    @keyframes float { 
      0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
      33% { transform: translateY(-8px) scale(1.01) rotate(1deg); }
      66% { transform: translateY(5px) scale(0.99) rotate(-0.5deg); }
    }

    .card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 2rem 1.5rem;
      width: 100%;
      max-width: 420px;
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.12),
        0 4px 16px rgba(0,0,0,0.06),
        0 0 0 0.5px rgba(255,255,255,0.1);
      position: relative;
      z-index: 10;
      animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      margin: 1rem 0;
    }
    
    @keyframes slideUp { 
      from { 
        opacity: 0; 
        transform: translateY(40px) scale(0.95); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    .language-switcher {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 0.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 20;
    }

    .language-switcher button {
      background: none;
      border: none;
      padding: 0.5rem;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .language-switcher button.active {
      background: #ff6b9d;
    }

    .language-switcher button:hover {
      background: rgba(255, 107, 157, 0.1);
    }

    .logo { 
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      box-shadow: 0 8px 32px rgba(255,107,157,0.25);
      overflow: hidden;
      padding: 2px;
    }
    .logo img { 
      width: 64px; 
      height: 64px; 
      object-fit: contain;
      display: block;
    }

    .brand-name { 
      background: linear-gradient(135deg, #ff6b9d, #ffa726);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.5rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 0.5rem;
      line-height: 1.1;
    }

    .tagline { 
      font-size: 1.2rem;
      font-weight: 600;
      text-align: center;
      color: #2d3748;
      margin-bottom: 1rem;
      line-height: 1.3;
    }

    .subtitle { 
      font-size: 1rem;
      color: #718096;
      text-align: center;
      margin-bottom: 2rem;
      line-height: 1.5;
    }

    .form-container { 
      margin-bottom: 2rem; 
    }

    .input-group { 
      margin-bottom: 1rem; 
      position: relative;
    }

    input, select {
      width: 100%;
      padding: 1rem 1.25rem;
      font-size: 1.05rem;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 1rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 3rem;
    }

    input:focus, select:focus {
      border-color: #ff6b9d;
      box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
      transform: translateY(-1px);
      background: white;
    }

    input::placeholder { 
      color: #a0aec0;
      font-weight: 400;
    }

    input.error, select.error {
      border-color: #e53e3e;
      box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
    }

    .checkbox-container {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin: 1.5rem 0;
      font-size: 0.9rem;
      line-height: 1.4;
      padding: 1rem;
      background: rgba(255, 107, 157, 0.05);
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .checkbox-container.error {
      border-color: #e53e3e;
      background: rgba(229, 62, 62, 0.05);
    }

    .checkbox-container input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin: 0;
      margin-top: 2px;
      cursor: pointer;
      accent-color: #ff6b9d;
      transform: scale(1.2);
    }

    .checkbox-container label {
      color: #2d3748;
      cursor: pointer;
      font-weight: 500;
      flex: 1;
    }

    .checkbox-container a {
      color: #ff6b9d;
      text-decoration: none;
      font-weight: 600;
      border-bottom: 1px solid transparent;
      transition: border-color 0.2s ease;
    }

    .checkbox-container a:hover {
      border-bottom-color: #ff6b9d;
    }

    .required-asterisk {
      color: #e53e3e;
      font-weight: bold;
      margin-left: 4px;
    }

    .submit-btn {
      width: 100%;
      padding: 1.1rem 1.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #ff6b9d, #ffa726);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin-top: 0.5rem;
      position: relative;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .submit-btn:active {
      transform: translateY(1px) scale(0.98);
    }

    .submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .submit-btn::before {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 0; height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .submit-btn:active:not(:disabled)::before {
      width: 300px;
      height: 300px;
    }

    .features {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin: 2rem 0;
    }

    .feature {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(255, 107, 157, 0.1);
      font-weight: 500;
      color: #2d3748;
    }

    .feature-icon {
      width: 20px;
      height: 20px;
      color: #ff6b9d;
      flex-shrink: 0;
    }

    .feature-text {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .social-proof {
      text-align: center;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(226, 232, 240, 0.8);
    }

    .counter {
      font-size: 2.2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ff6b9d, #ffa726);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      line-height: 1;
    }

    .counter-label {
      font-size: 0.85rem;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    .message {
      display: none;
      padding: 1rem;
      border-radius: 12px;
      text-align: center;
      font-weight: 500;
      margin-top: 1rem;
      animation: slideUp 0.4s ease;
    }

    .success-message {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
    }

    .error-message {
      background: linear-gradient(135deg, #f56565, #e53e3e);
      color: white;
    }

    .connection-status {
      position: fixed;
      top: env(safe-area-inset-top, 1rem);
      left: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      z-index: 20;
      backdrop-filter: blur(10px);
    }

    .connection-status.online {
      background: rgba(72, 187, 120, 0.2);
      color: #2f855a;
      border: 1px solid rgba(72, 187, 120, 0.3);
    }

    .connection-status.offline {
      background: rgba(245, 101, 101, 0.2);
      color: #c53030;
      border: 1px solid rgba(245, 101, 101, 0.3);
    }

    .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .success-content {
      background: white;
      border-radius: 24px;
      padding: 3rem 2rem;
      text-align: center;
      max-width: 400px;
      animation: successPop 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes successPop {
      from { opacity: 0; transform: scale(0.8) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #48bb78, #38a169);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      color: white;
      font-size: 2rem;
    }

    /* Responsive pour tablettes */
    @media (min-width: 768px) {
      .container { padding: 2rem; }
      .card { padding: 3rem 2.5rem; max-width: 480px; }
      .brand-name { font-size: 3rem; }
      .tagline { font-size: 1.4rem; }
      .features {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
      }
      .feature { flex-direction: column; text-align: center; padding: 1.25rem 1rem; }
      .connection-status { top: 2rem; left: 2rem; }
      .language-switcher { top: 2rem; right: 2rem; }
    }

    /* Desktop */
    @media (min-width: 1024px) {
      .card { max-width: 520px; padding: 3.5rem 3rem; }
    }

    /* Support pour les encoches iPhone */
    @supports (padding: max(0px)) {
      .container {
        padding-left: max(1rem, env(safe-area-inset-left));
        padding-right: max(1rem, env(safe-area-inset-right));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    }

    /* Optimisations pour Safari iOS */
    @media screen and (-webkit-min-device-pixel-ratio: 2) {
      input { -webkit-text-size-adjust: 100%; }
    }
  </style>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="background-pattern"></div>

  <div class="container">
    <div class="connection-status" id="connectionStatus">
      ð Connecting...
    </div>

    <div class="language-switcher">
      <button onclick="switchLanguage('en')" id="btn-en">ðºð¸</button>
      <button onclick="switchLanguage('fr')" id="btn-fr">ð«ð·</button>
    </div>

    <div class="card">
      <div class="logo">
        <img src="https://uycerxczynebjatdhyef.supabase.co/storage/v1/object/public/assets/LoDi-Stylized_map_pin_with_a_star_on_top__integrating_location_and_festive_celebration__vector_icon_design__simple_and_recognizable._the_main_and_brand_color_is_purple_so_keep_this_type_and_change_the.png" alt="PartyGo Logo" />
      </div>

      <h1 class="brand-name">PartyGo</h1>
      <h2 class="tagline" data-en="Discover the best bars and parties around you." data-fr="DÃ©couvrez les meilleurs bars et soirÃ©es prÃ¨s de chez vous."></h2>
      <p class="subtitle" data-en="Earn points, climb ranks, and become a legend!" data-fr="Gagnez des points, grimpez dans le classement et devenez une lÃ©gende !"></p>

      <form class="form-container" id="waitlistForm">
        <div class="input-group">
          <input 
            type="text" 
            placeholder="Your name" 
            required 
            id="name" 
            autocomplete="name" 
            minlength="2"
          >
        </div>
        <div class="input-group">
          <input 
            type="email" 
            placeholder="Your email" 
            required 
            id="email" 
            autocomplete="email"
          >
        </div>
        <div class="input-group">
          <select id="source" required>
            <option value="">How did you hear about us?</option>
            <option value="instagram" data-en="Instagram" data-fr="Instagram">Instagram</option>
            <option value="facebook" data-en="Facebook" data-fr="Facebook">Facebook</option>
            <option value="tiktok" data-en="TikTok" data-fr="TikTok">TikTok</option>
            <option value="twitter" data-en="Twitter/X" data-fr="Twitter/X">Twitter/X</option>
            <option value="linkedin" data-en="LinkedIn" data-fr="LinkedIn">LinkedIn</option>
            <option value="word_of_mouth" data-en="Word of mouth" data-fr="Bouche-Ã -oreille">Word of mouth</option>
            <option value="google_search" data-en="Google search" data-fr="Recherche Google">Google search</option>
            <option value="friend_referral" data-en="Friend referral" data-fr="Recommandation d'un ami">Friend referral</option>
            <option value="event" data-en="Event/Conference" data-fr="ÃvÃ©nement/ConfÃ©rence">Event/Conference</option>
            <option value="blog_article" data-en="Blog/Article" data-fr="Blog/Article">Blog/Article</option>
            <option value="youtube" data-en="YouTube" data-fr="YouTube">YouTube</option>
            <option value="podcast" data-en="Podcast" data-fr="Podcast">Podcast</option>
            <option value="other" data-en="Other" data-fr="Autre">Other</option>
          </select>
        </div>

        <div class="checkbox-container" id="consentContainer">
          <input type="checkbox" id="consent" required>
          <label for="consent">
            <span data-en="I agree to the " data-fr="J'accepte la ">I agree to the </span>
            <a href="#" onclick="showPrivacyPolicy()" data-en="Privacy Policy" data-fr="Politique de ConfidentialitÃ©">Privacy Policy</a>
            <span data-en=" and consent to receive emails about PartyGo updates" data-fr=" et consens Ã  recevoir des emails concernant les actualitÃ©s de PartyGo"> and consent to receive emails about PartyGo updates</span>
            <span class="required-asterisk">*</span>
          </label>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          <div class="loading-spinner" id="loadingSpinner"></div>
          <span id="buttonText" data-en="Join the Waitlist" data-fr="Rejoindre la Liste d'Attente">Join the Waitlist</span>
        </button>

        <div class="message success-message" id="successMessage">
          <span data-en="ð You're in! Welcome to the PartyGo's journey" data-fr="ð Vous Ãªtes inscrit ! Bienvenue dans l'aventure PartyGo">ð You're in! Welcome to the PartyGo's journey</span>
        </div>

        <div class="message error-message" id="errorMessage">
          <span data-en="Something went wrong. Please try again." data-fr="Une erreur s'est produite. Veuillez rÃ©essayer.">Something went wrong. Please try again.</span>
        </div>
      </form>

      <div class="features">
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
          </svg>
          <span class="feature-text" data-en="Priority Access" data-fr="AccÃ¨s Prioritaire">Priority Access</span>
        </div>
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="feature-text" data-en="Extra points" data-fr="Points bonus">Extra points</span>
        </div>
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
          </svg>
          <span class="feature-text" data-en="Rewards" data-fr="RÃ©compenses">Rewards</span>
        </div>
      </div>

      <div class="social-proof">
        <div class="counter" id="counter">100</div>
        <div class="counter-label" data-en="People waiting" data-fr="Personnes en attente">People waiting</div>
      </div>
    </div>
  </div>

  <!-- Success Overlay -->
  <div class="success-overlay" id="successOverlay">
    <div class="success-content">
      <div class="success-icon">â</div>
      <h2 style="color: #2d3748; margin-bottom: 1rem; font-size: 1.5rem;" data-en="Welcome aboard!" data-fr="Bienvenue Ã  bord !">Welcome aboard!</h2>
      <p style="color: #4a5568; margin-bottom: 1.5rem; line-height: 1.5;" data-en="Check your email for a welcome message from the PartyGo team. We're excited to have you!" data-fr="VÃ©rifiez votre email pour un message de bienvenue de l'Ã©quipe PartyGo. Nous sommes ravis de vous avoir avec nous !">Check your email for a welcome message from the PartyGo team. We're excited to have you!</p>
      <button onclick="closeSuccessOverlay()" style="background: linear-gradient(135deg, #ff6b9d, #ffa726); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600; cursor: pointer;" data-en="Continue" data-fr="Continuer">Continue</button>
    </div>
  </div>

  <script>
    // Configuration
    const SUPABASE_URL = "https://uycerxczynebjatdhyef.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5Y2VyeGN6eW5lYmphdGRoeWVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4ODI1NTAsImV4cCI6MjA3MjQ1ODU1MH0.KrEdzR5UnuRw2zj95hJDn4BfeiaYHS3O--ZcYOPQL58";

    let supabaseClient;
    let isConnected = false;
    let currentCount = 100;
    let currentLanguage = 'en';

    // Traductions
    const translations = {
      connecting: { en: 'ð Connecting...', fr: 'ð Connexion...' },
      online: { en: 'ð¢ Online', fr: 'ð¢ En ligne' },
      offline: { en: 'ð´ Offline', fr: 'ð´ Hors ligne' },
      joining: { en: 'Joining...', fr: 'Inscription...' },
      errorFields: { en: 'â Please fill in all fields correctly', fr: 'â Veuillez remplir tous les champs correctement' },
      errorConnection: { en: 'â No connection. Please try again.', fr: 'â Pas de connexion. Veuillez rÃ©essayer.' },
      errorEmail: { en: 'Please enter a valid email address', fr: 'Veuillez entrer une adresse email valide' },
      errorAlreadyRegistered: { en: 'â ï¸ Email already registered!', fr: 'â ï¸ Email dÃ©jÃ  enregistrÃ© !' },
      errorRegistration: { en: 'â Registration failed. Try again.', fr: 'â Inscription Ã©chouÃ©e. RÃ©essayez.' },
      errorNetwork: { en: 'â Network error. Check connection.', fr: 'â Erreur rÃ©seau. VÃ©rifiez la connexion.' }
    };

    function updateLanguage(lang) {
      currentLanguage = lang;
      document.documentElement.lang = lang;
      localStorage.setItem('partygo-language', lang);
      
      // Update active language button
      document.querySelectorAll('.language-switcher button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`btn-${lang}`).classList.add('active');
      
      // Update all translatable elements
      document.querySelectorAll(`[data-${lang}]`).forEach(element => {
        const text = element.getAttribute(`data-${lang}`);
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          element.placeholder = text;
        } else if (element.tagName === 'OPTION') {
          element.textContent = text;
        } else {
          element.textContent = text;
        }
      });

      // Update input placeholders specifically
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      
      if (lang === 'fr') {
        if (nameInput) nameInput.placeholder = 'Votre nom';
        if (emailInput) emailInput.placeholder = 'Votre email';
      } else {
        if (nameInput) nameInput.placeholder = 'Your name';
        if (emailInput) emailInput.placeholder = 'Your email';
      }

      // Update select placeholder
      const sourceSelect = document.getElementById('source');
      if (sourceSelect) {
        const firstOption = sourceSelect.querySelector('option[value=""]');
        if (firstOption) {
          firstOption.textContent = lang === 'fr' ? 
            'Comment avez-vous entendu parler de nous ?' : 
            'How did you hear about us?';
        }
      }

      // Update connection status
      updateConnectionStatus(isConnected);
    }

    function switchLanguage(lang) {
      updateLanguage(lang);
    }

    function detectLanguage() {
      const urlParams = new URLSearchParams(window.location.search);
      const urlLang = urlParams.get('lang');
      const savedLang = localStorage.getItem('partygo-language');
      const browserLang = navigator.language.startsWith('fr') ? 'fr' : 'en';
      
      return urlLang || savedLang || browserLang;
    }

    function updateConnectionStatus(online) {
      const status = document.getElementById('connectionStatus');
      const text = online ? translations.online[currentLanguage] : translations.offline[currentLanguage];
      status.textContent = text;
      status.className = `connection-status ${online ? 'online' : 'offline'}`;
      isConnected = online;
    }

    function showMessage(type, customText = null) {
      ['successMessage', 'errorMessage'].forEach(id => {
        document.getElementById(id).style.display = 'none';
      });
      
      const element = document.getElementById(`${type}Message`);
      if (customText) {
        element.querySelector('span').textContent = customText;
      }
      element.style.display = 'block';
      
      setTimeout(() => element.style.display = 'none', 4000);
    }

    function setButtonLoading(loading) {
      const btn = document.getElementById('submitBtn');
      const spinner = document.getElementById('loadingSpinner');
      const text = document.getElementById('buttonText');
      
      btn.disabled = loading;
      spinner.style.display = loading ? 'inline-block' : 'none';
      
      if (loading) {
        text.textContent = translations.joining[currentLanguage];
      } else {
        text.textContent = text.getAttribute(`data-${currentLanguage}`);
      }
    }

    function isValidEmail(email) {
      const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
      
      if (!emailRegex.test(email)) return false;
      
      const domain = email.split('@')[1]?.toLowerCase();
      const localPart = email.split('@')[0]?.toLowerCase();
      
      const disposableDomains = [
        '10minutemail.com', 'tempmail.org', 'guerrillamail.com', 
        'mailinator.com', 'temp-mail.org', 'throwaway.email',
        'yopmail.com', 'maildrop.cc', 'temp-mail.io',
        'mohmal.com', 'sharklasers.com', 'grr.la'
      ];
      
      const suspiciousPatterns = [
        /^test/i, /^fake/i, /^example/i,
        /\d{8,}/, /^[a-z]{15,}$/i
      ];
      
      const suspiciousDomains = [
        'test.com', 'fake.com', 'example.com', 'test.fr', 'fake.fr'
      ];
      
      if (disposableDomains.includes(domain)) return false;
      if (suspiciousDomains.includes(domain)) return false;
      if (suspiciousPatterns.some(pattern => pattern.test(localPart))) return false;
      if (!domain || !domain.includes('.')) return false;
      if (localPart.length > 64 || domain.length > 253) return false;
      
      return true;
    }

    function validateEmailRealTime(email) {
      const input = document.getElementById('email');
      
      if (!email) {
        input.setCustomValidity('');
        return true;
      }
      
      if (!isValidEmail(email)) {
        input.setCustomValidity(translations.errorEmail[currentLanguage]);
        return false;
      }
      
      input.setCustomValidity('');
      return true;
    }

    function showPrivacyPolicy() {
      const privacyText = currentLanguage === 'fr' ? 
        `Politique de ConfidentialitÃ© PartyGo

Nous collectons votre nom et email uniquement pour vous informer du lancement de PartyGo.

Vos donnÃ©es sont stockÃ©es de maniÃ¨re sÃ©curisÃ©e et ne seront jamais vendues Ã  des tiers.

Vous pouvez vous dÃ©sinscrire Ã  tout moment en nous contactant Ã  hello@partygo.app.

ConformÃ©ment au RGPD, vous avez le droit d'accÃ©der, modifier ou supprimer vos donnÃ©es.` :
        `PartyGo Privacy Policy

We collect your name and email only to notify you about PartyGo's launch.

Your data is stored securely and will never be sold to third parties.

You can unsubscribe at any time by contacting us at hello@partygo.app.

In accordance with GDPR, you have the right to access, modify or delete your data.`;
      
      alert(privacyText);
    }

    function showSuccessOverlay() {
      document.getElementById('successOverlay').style.display = 'flex';
    }

    function closeSuccessOverlay() {
      document.getElementById('successOverlay').style.display = 'none';
    }

    function animateCounter(target) {
      const counter = document.getElementById('counter');
      let current = Math.max(100, currentCount);
      const increment = Math.max(1, (target - current) / 60);
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        counter.textContent = Math.floor(current).toLocaleString();
        currentCount = Math.floor(current);
      }, 20);
    }

    function incrementCounter() {
      currentCount++;
      const counter = document.getElementById('counter');
      
      counter.style.transform = 'scale(1.1)';
      counter.style.transition = 'transform 0.2s ease';
      
      setTimeout(() => {
        counter.textContent = currentCount.toLocaleString();
        counter.style.transform = 'scale(1)';
      }, 100);

      localStorage.setItem('partygo-counter', currentCount.toString());
    }

    function loadSavedCounter() {
      const saved = localStorage.getItem('partygo-counter');
      if (saved) {
        currentCount = Math.max(100, parseInt(saved));
      }
      return currentCount;
    }

    async function loadStats() {
      try {
        const { count } = await supabaseClient
          .from('waitlist')
          .select('*', { count: 'exact', head: true });
        
        return (count || 0) + 100;
      } catch (error) {
        console.warn('Could not load stats from Supabase:', error);
        return currentCount;
      }
    }

    async function sendWelcomeEmailResend(name, email, source) {
      try {
        console.log(`Sending welcome email via Resend to ${name} (${email})`);
        
        const response = await fetch(`${SUPABASE_URL}/functions/v1/send-welcome-email`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${SUPABASE_ANON}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            email: email,
            source: source,
            language: currentLanguage
          })
        });

        if (response.ok) {
          const result = await response.json();
          console.log('Email sent successfully via Resend:', result);
          return { success: true };
        } else {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to send email');
        }
        
      } catch (error) {
        console.error('Resend failed:', error);
        return { success: false, error };
      }
    }

    async function init() {
      // Initialize language
      const detectedLang = detectLanguage();
      updateLanguage(detectedLang);
      
      try {
        const savedCount = loadSavedCounter();
        
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
        
        const { error } = await supabaseClient
          .from('waitlist')
          .select('id')
          .limit(1);

        updateConnectionStatus(!error);
        
        if (error && error.message.includes('relation') && error.message.includes('does not exist')) {
          showMessage('error', 'â ï¸ Database not configured yet');
          animateCounter(savedCount);
        } else {
          const realCount = await loadStats();
          const finalCount = Math.max(savedCount, realCount);
          animateCounter(finalCount);
        }
        
      } catch (err) {
        console.error('Init error:', err);
        updateConnectionStatus(false);
        animateCounter(loadSavedCounter());
      }

      // Event listeners for real-time validation
      document.getElementById('email').addEventListener('input', (e) => {
        validateEmailRealTime(e.target.value);
      });

      document.getElementById('email').addEventListener('blur', (e) => {
        const email = e.target.value.trim();
        if (email && !isValidEmail(email)) {
          showMessage('error', translations.errorEmail[currentLanguage]);
        }
      });
    }

    document.getElementById('waitlistForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      const sourceInput = document.getElementById('source');
      const consentInput = document.getElementById('consent');
      const consentContainer = document.getElementById('consentContainer');
      
      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const source = sourceInput.value;
      const consent = consentInput.checked;

      // Reset error states
      [nameInput, emailInput, sourceInput].forEach(input => {
        input.classList.remove('error');
      });
      consentContainer.classList.remove('error');

      let hasError = false;
      let firstErrorField = null;
      
      if (!name || name.length < 2) {
        nameInput.classList.add('error');
        hasError = true;
        if (!firstErrorField) firstErrorField = nameInput;
      }
      
      if (!email || !isValidEmail(email)) {
        emailInput.classList.add('error');
        hasError = true;
        if (!firstErrorField) firstErrorField = emailInput;
      }
      
      if (!source) {
        sourceInput.classList.add('error');
        hasError = true;
        if (!firstErrorField) firstErrorField = sourceInput;
      }
      
      if (!consent) {
        consentContainer.classList.add('error');
        hasError = true;
        if (!firstErrorField) firstErrorField = consentInput;
        
        showMessage('error', currentLanguage === 'fr' ? 
          'â Vous devez accepter la politique de confidentialitÃ© pour continuer' : 
          'â You must accept the privacy policy to continue');
        
        // Scroll vers la checkbox si elle n'est pas visible
        consentContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }

      if (hasError) {
        showMessage('error', translations.errorFields[currentLanguage]);
        // Focus sur le premier champ en erreur
        if (firstErrorField) {
          firstErrorField.focus();
        }
        return;
      }

      if (!isConnected) {
        showMessage('error', translations.errorConnection[currentLanguage]);
        return;
      }

      setButtonLoading(true);

      try {
        // Insert into Supabase with source tracking
        const { data, error } = await supabaseClient
          .from('waitlist')
          .insert([{ 
            name, 
            email, 
            source, 
            language: currentLanguage,
            created_at: new Date().toISOString()
          }])
          .select();

        if (!error && data) {
          document.getElementById('waitlistForm').reset();

          // Send welcome email
          try {
            await sendWelcomeEmailResend(name, email, source);
          } catch (emailError) {
            console.warn('Email sending failed:', emailError);
          }

          incrementCounter();
          showSuccessOverlay();
          
        } else {
          if (error?.code === '23505') {
            showMessage('error', translations.errorAlreadyRegistered[currentLanguage]);
          } else {
            showMessage('error', translations.errorRegistration[currentLanguage]);
          }
        }
      } catch (err) {
        showMessage('error', translations.errorNetwork[currentLanguage]);
      } finally {
        setButtonLoading(false);
      }
    });

    // Sync counter periodically
    setInterval(async () => {
      if (isConnected) {
        try {
          const realCount = await loadStats();
          if (realCount > currentCount) {
            currentCount = realCount;
            document.getElementById('counter').textContent = currentCount.toLocaleString();
            localStorage.setItem('partygo-counter', currentCount.toString());
          }
        } catch (error) {
          console.warn('Failed to sync stats:', error);
        }
      }
    }, 60000);

    // iOS touch optimization
    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
      document.addEventListener('touchstart', function() {}, true);
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
