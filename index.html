<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rejoignez Notre Waitlist - PartyGo</title>

  <!-- Styles (vos styles originaux + corrections) -->
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #ff6b9d 0%, #ffa726 100%);
      min-height: 100vh; 
      overflow-x: hidden;
    }
    .container { 
      min-height:100vh; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      padding:2rem; 
      position:relative; 
    }
    .background-pattern { 
      position:absolute; 
      inset:0;
      background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
    }
    @keyframes float { 
      0%,100%{transform:translateY(0) rotate(0)} 
      50%{transform:translateY(-20px) rotate(1deg)} 
    }
    .card {
      background: rgba(255,255,255,0.95); 
      backdrop-filter: blur(20px);
      border-radius:24px; 
      padding:3rem; 
      max-width:500px; 
      width:100%;
      box-shadow: 0 25px 50px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.2);
      position:relative; 
      z-index:1; 
      animation: slideUp .8s ease-out;
    }
    @keyframes slideUp { 
      from{opacity:0; transform:translateY(30px)} 
      to{opacity:1; transform:translateY(0)} 
    }
    .logo{ 
      width:100px; 
      height:100px; 
      background:white; 
      border-radius:50%; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      margin:0 auto 2rem; 
      box-shadow:0 10px 30px rgba(255,107,157,.3); 
      overflow:hidden; 
    }
    .logo svg{ width:80px; height:80px; }
    h1{ 
      font-size:2.5rem; 
      font-weight:800; 
      text-align:center; 
      color:#1a1a1a; 
      margin-bottom:1rem; 
      line-height:1.2; 
    }
    .brand-name{ 
      background:linear-gradient(135deg, #ff6b9d, #ffa726); 
      -webkit-background-clip:text; 
      -webkit-text-fill-color:transparent; 
      background-clip:text; 
      font-size:3rem; 
      font-weight:900; 
      margin-bottom:.5rem; 
    }
    h2{ 
      font-size:1.5rem; 
      font-weight:600; 
      text-align:center; 
      color:#333; 
      margin-bottom:2rem; 
    }
    .subtitle{ 
      font-size:1.1rem; 
      color:#666; 
      text-align:center; 
      margin-bottom:2rem; 
      line-height:1.6; 
    }

    .form-container { margin-bottom:2rem; }
    .input-group{ margin-bottom:1rem; }
    input{
      width:100%; 
      padding:1rem 1.5rem; 
      font-size:1rem; 
      border:2px solid #e1e8ed; 
      border-radius:12px; 
      background:white; 
      transition:all .3s ease; 
      outline:none;
    }
    input:focus{ 
      border-color:#ff6b9d; 
      box-shadow:0 0 0 4px rgba(255,107,157,.1); 
      transform: translateY(-2px); 
    }
    input::placeholder{ color:#9ca3af; }

    .submit-btn{
      width:100%; 
      padding:1rem 2rem; 
      font-size:1.1rem; 
      font-weight:600; 
      color:white;
      background: linear-gradient(135deg, #ff6b9d, #ffa726); 
      border:none; 
      border-radius:12px; 
      cursor:pointer; 
      transition: all .3s ease; 
      margin-top:1rem; 
      position:relative; 
      overflow:hidden;
    }
    .submit-btn:hover:not(:disabled){ 
      transform: translateY(-2px); 
      box-shadow:0 10px 25px rgba(255,107,157,.3); 
    }
    .submit-btn:active:not(:disabled){ transform: translateY(0); }
    .submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    .submit-btn::before{
      content:''; 
      position:absolute; 
      top:50%; 
      left:50%; 
      width:0; 
      height:0; 
      background:rgba(255,255,255,.2); 
      border-radius:50%; 
      transform:translate(-50%,-50%); 
      transition:width .6s, height .6s;
    }
    .submit-btn:active:not(:disabled)::before{ width:300px; height:300px; }

    /* Features (3 cartes c√¥te √† c√¥te, bordure d√©grad√©e) */
    .features{ 
      display:grid; 
      grid-template-columns:repeat(3, minmax(0, 1fr)); 
      gap:14px; 
      margin-top:2rem; 
    }
    .feature{
      --pink:#ff6b9d; 
      --orange:#ffa726;
      display:flex; 
      align-items:center; 
      justify-content:center; 
      gap:10px;
      padding:14px 18px; 
      border-radius:14px; 
      font-weight:500; 
      color:#333;
      border:2px solid transparent;
      background: linear-gradient(#fff,#fff) padding-box,
                  linear-gradient(135deg, var(--pink), var(--orange)) border-box;
      box-shadow:0 4px 14px rgba(0,0,0,.06);
    }
    .feature-icon{ 
      width:22px; 
      height:22px; 
      color:var(--pink); 
      flex-shrink:0; 
    }
    .feature-text{ 
      font-size:1rem; 
      color:#3a3a3a; 
      font-weight:600; 
      letter-spacing:.2px; 
    }

    .social-proof{ 
      text-align:center; 
      margin-top:2rem; 
      padding-top:2rem; 
      border-top:1px solid #e1e8ed; 
    }
    .counter{ 
      font-size:2rem; 
      font-weight:700; 
      background:linear-gradient(135deg, #ff6b9d, #ffa726); 
      -webkit-background-clip:text; 
      -webkit-text-fill-color:transparent; 
      background-clip:text; 
      margin-bottom:.5rem; 
    }
    .counter-label{ 
      font-size:.9rem; 
      color:#666; 
      text-transform:uppercase; 
      letter-spacing:.5px; 
    }
    .success-message{ 
      display:none; 
      background:linear-gradient(135deg, #10b981, #059669); 
      color:white; 
      padding:1rem; 
      border-radius:12px; 
      text-align:center; 
      font-weight:500; 
      margin-top:1rem; 
      animation: slideUp .5s ease-out;
    }

    /* Message d'erreur ajout√© */
    .error-message {
      display:none; 
      background:linear-gradient(135deg, #ef4444, #dc2626); 
      color:white; 
      padding:1rem; 
      border-radius:12px; 
      text-align:center; 
      font-weight:500; 
      margin-top:1rem; 
      animation: slideUp .5s ease-out;
    }

    /* Indicateur de connexion */
    .connection-status {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      opacity: 0.9;
      z-index: 10;
    }
    .connection-status.online {
      background: rgba(16, 185, 129, 0.2);
      color: #059669;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    .connection-status.offline {
      background: rgba(239, 68, 68, 0.2);
      color: #dc2626;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    @media (max-width:768px){ 
      .card{ padding:2rem; margin:1rem; } 
      .brand-name{ font-size:2.5rem; } 
      h2{ font-size:1.3rem; } 
      .subtitle{ font-size:1rem; } 
      .features{ grid-template-columns:1fr; gap:12px; }
      .container { padding: 1rem; }
      .connection-status {
        position: relative;
        top: 0;
        right: 0;
        margin-bottom: 1rem;
        text-align: center;
      }
    }
    
    .floating-elements{ 
      position:absolute; 
      width:100%; 
      height:100%; 
      overflow:hidden; 
      pointer-events:none; 
    }
    .floating-element{ 
      position:absolute; 
      background:rgba(255,255,255,.1); 
      border-radius:50%; 
      animation:floatAround 15s infinite linear; 
    }
    .floating-element:nth-child(1){ 
      width:60px; 
      height:60px; 
      top:20%; 
      left:10%; 
      animation-delay:-2s; 
    }
    .floating-element:nth-child(2){ 
      width:40px; 
      height:40px; 
      top:60%; 
      right:15%; 
      animation-delay:-8s; 
    }
    .floating-element:nth-child(3){ 
      width:80px; 
      height:80px; 
      bottom:20%; 
      left:20%; 
      animation-delay:-5s; 
    }
    @keyframes floatAround{ 
      0%{transform:translateY(0) rotate(0)} 
      33%{transform:translateY(-30px) rotate(120deg)} 
      66%{transform:translateY(15px) rotate(240deg)} 
      100%{transform:translateY(0) rotate(360deg)} 
    }
  </style>

  <!-- Supabase JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="floating-elements">
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
  </div>
  <div class="background-pattern"></div>

  <div class="container">
    <!-- Indicateur de connexion -->
    <div class="connection-status" id="connectionStatus">
      üîÑ Connecting...
    </div>

    <div class="card">
      <div class="logo">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#ff6b9d"/>
              <stop offset="100%" style="stop-color:#ffa726"/>
            </linearGradient>
          </defs>
          <path d="M50 10 C35 10 25 20 25 35 C25 50 50 80 50 80 C50 80 75 50 75 35 C75 20 65 10 50 10 Z" fill="url(#logoGradient)"/>
          <circle cx="50" cy="35" r="15" fill="white"/>
          <path d="M50 25 L52.5 32 L60 32 L54.5 37 L57 44 L50 39 L43 44 L45.5 37 L40 32 L47.5 32 Z" fill="url(#logoGradient)"/>
        </svg>
      </div>

      <h1 class="brand-name">PartyGo</h1>
      <h2>Discover the best bars & parties around you</h2>
      <p class="subtitle">Earn points, climb the ranks, and become a legend!<br/>Join the waitlist NOW!</p>

      <form class="form-container" id="waitlistForm">
        <div class="input-group">
          <input type="text" placeholder="Your name" required id="name" autocomplete="name" minlength="2">
        </div>
        <div class="input-group">
          <input type="email" placeholder="Your email" required id="email" autocomplete="email">
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">Join the waitlist</button>

        <div class="success-message" id="successMessage">
          üéâ Welcome to the PartyGo community! We'll be in touch soon with your priority access!
        </div>

        <!-- Message d'erreur ajout√© -->
        <div class="error-message" id="errorMessage">
          ‚ùå Something went wrong. Please try again.
        </div>
      </form>

      <div class="features">
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/>
          </svg>
          <span class="feature-text">Priority access</span>
        </div>
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="feature-text">Member exclusives</span>
        </div>
        <div class="feature">
          <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
          </svg>
          <span class="feature-text">Rewards</span>
        </div>
      </div>

      <div class="social-proof">
        <div class="counter" id="counter">1,247</div>
        <div class="counter-label">Already signed up</div>
      </div>
    </div>
  </div>

  <!-- Script de la page -->
  <script>
    // üîß CONFIGURATION SUPABASE - REMPLACEZ CES VALEURS
    const SUPABASE_URL = "https://uycerxczynebjatdhyef.supabase.co/";            // ‚ö†Ô∏è Remplacez par votre URL
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5Y2VyeGN6eW5lYmphdGRoeWVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4ODI1NTAsImV4cCI6MjA3MjQ1ODU1MH0.KrEdzR5UnuRw2zj95hJDn4BfeiaYHS3O--ZcYOPQL58";      // ‚ö†Ô∏è Remplacez par votre cl√© anon

    let supabaseClient;
    let isConnected = false;

    // Fonctions utilitaires
    function updateConnectionStatus(online) {
      const status = document.getElementById('connectionStatus');
      if (online) {
        status.textContent = 'üü¢ Connected';
        status.className = 'connection-status online';
        isConnected = true;
      } else {
        status.textContent = 'üî¥ Offline';
        status.className = 'connection-status offline';
        isConnected = false;
      }
    }

    function showMessage(elementId, customText = null) {
      // Cacher tous les messages
      document.getElementById('successMessage').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
      
      // Afficher le message demand√©
      const element = document.getElementById(elementId);
      if (customText) {
        element.textContent = customText;
      }
      element.style.display = 'block';
      
      // Auto-hide apr√®s 4 secondes
      setTimeout(() => {
        element.style.display = 'none';
      }, 4000);
    }

    function isValidEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function resetButton(submitBtn, originalText) {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      submitBtn.style.background = 'linear-gradient(135deg, #ff6b9d, #ffa726)';
    }

    // Initialisation au chargement de la page
    window.addEventListener('load', async () => {
      // V√©rifier si la configuration est renseign√©e
      if (SUPABASE_URL.includes('YOUR_PROJECT_ID')) {
        updateConnectionStatus(false);
        showMessage('errorMessage', '‚ö†Ô∏è Please configure SUPABASE_URL and SUPABASE_ANON in the code');
        return;
      }

      try {
        // Initialiser Supabase
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
        
        // Test de connexion
        const { error } = await supabaseClient
          .from('waitlist')
          .select('id')
          .limit(1);

        if (error) {
          console.error('Supabase connection error:', error);
          updateConnectionStatus(false);
          if (error.message.includes('relation') && error.message.includes('does not exist')) {
            showMessage('errorMessage', '‚ö†Ô∏è Table "waitlist" not found. Please create it first.');
          }
        } else {
          updateConnectionStatus(true);
        }

        // Animation du compteur (votre code original)
        const counter = document.getElementById('counter');
        let n = 0, target = 1247;
        const timer = setInterval(() => {
          n += Math.ceil(target/60);
          if(n >= target){ 
            n = target; 
            clearInterval(timer); 
          }
          counter.textContent = n.toLocaleString('fr-FR');
        }, 30);

      } catch (err) {
        console.error('Initialization error:', err);
        updateConnectionStatus(false);
        showMessage('errorMessage', '‚ùå Failed to initialize. Check console for details.');
      }
    });

    // Gestion du formulaire (votre code original am√©lior√©)
    document.getElementById('waitlistForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      const successMessage = document.getElementById('successMessage');
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();

      // Validation c√¥t√© client
      if (!name || name.length < 2) {
        showMessage('errorMessage', '‚ùå Please enter a valid name (at least 2 characters)');
        return;
      }

      if (!email || !isValidEmail(email)) {
        showMessage('errorMessage', '‚ùå Please enter a valid email address');
        return;
      }

      if (!isConnected) {
        showMessage('errorMessage', '‚ùå No connection to database. Please try again later.');
        return;
      }

      // √âtat envoi (votre code original)
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Inscription en cours...';
      submitBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';

      try {
        // INSERT en base (votre code original)
        const { error } = await supabaseClient
          .from('waitlist')
          .insert([{ name, email }]);

        if (!error) {
          // Succ√®s (votre code original)
          successMessage.style.display = 'block';
          e.target.reset();

          // Remettre le bouton + cacher le message apr√®s 3s (votre code original)
          setTimeout(() => {
            successMessage.style.display = 'none';
            resetButton(submitBtn, originalText);
          }, 3000);

          // Compteur visuel (votre code original)
          const counter = document.getElementById('counter');
          const cur = parseInt(counter.textContent.replace(/[^\d]/g,'')) || 1247;
          counter.textContent = (cur + 1).toLocaleString('fr-FR');

        } else {
          // Gestion d'erreurs am√©lior√©e
          console.error('Insert error:', error);
          
          if (error.code === '23505' || error.message.includes('duplicate')) {
            showMessage('errorMessage', '‚ö†Ô∏è This email is already registered!');
          } else if (error.message.includes('policy')) {
            showMessage('errorMessage', '‚ùå Access denied. Please check database permissions.');
          } else {
            showMessage('errorMessage', '‚ùå Registration failed. Please try again.');
          }
          
          resetButton(submitBtn, originalText);
        }

      } catch (err) {
        console.error('Submission error:', err);
        showMessage('errorMessage', '‚ùå Network error. Please check your connection.');
        resetButton(submitBtn, originalText);
      }
    });

    // Gestion des erreurs globales
    window.addEventListener('error', (e) => {
      console.error('Global JavaScript error:', e.error);
    });

    // Test de connectivit√© p√©riodique (nouveau)
    setInterval(async () => {
      if (!supabaseClient) return;
      
      try {
        await supabaseClient.from('waitlist').select('id').limit(1);
        if (!isConnected) updateConnectionStatus(true);
      } catch {
        if (isConnected) updateConnectionStatus(false);
      }
    }, 30000); // V√©rification toutes les 30 secondes
  </script>
</body>
</html>